<?xml version="1.0" encoding="UTF-8"?>

<services-config>

	<services>
		<service id="granite-service" class="flex.messaging.services.RemotingService"
			messageTypes="flex.messaging.messages.RemotingMessage">
			<destination id="spring">
				<channels>
					<channel ref="my-secure-graniteamf" />
				</channels>
				<properties>
					<factory>tideSpringFactory</factory>
					<persistence-manager-bean-name>tidePersistenceManager</persistence-manager-bean-name>
				</properties>
				<security>
					<security-constraint>
						<auth-method>Custom</auth-method>
						<roles>
							<role>ROLE_CARGO_USER</role>
						</roles>
					</security-constraint>
				</security>

			</destination>

		</service>
	</services>

	<factories>
		<factory id="tideSpringFactory" class="org.granite.tide.spring.SpringServiceFactory" />
	</factories>

	<channels>
		<channel-definition id="my-secure-graniteamf"
			class="mx.messaging.channels.SecureAMFChannel">
			<endpoint
				uri="https://{server.name}:{server.port}/graniteamf/amfchannel.amf"
				class="flex.messaging.endpoints.SecureAMFEndpoint" />
			<properties>
				<add-no-cache-headers>false</add-no-cache-headers>
			</properties>
		</channel-definition>
	</channels>

	<logging>
		<target class="flex.messaging.log.ConsoleTarget" level="Error">
			<properties>
				<prefix>[GraniteDS] </prefix>
				<includeDate>true</includeDate>
				<includeTime>true</includeTime>
				<includeLevel>true</includeLevel>
				<includeCategory>true</includeCategory>
			</properties>
		</target>
	</logging>

	<system>
		<redeploy>
			<enabled>true</enabled>
			<watch-interval>20</watch-interval>
			<watch-file>{context.root}/WEB-INF/flex/services-config.xml</watch-file>
			<watch-file>{context.root}/WEB-INF/granite/granite-config.xml</watch-file>
			<touch-file>{context.root}/WEB-INF/web.xml</touch-file>
		</redeploy>
	</system>

</services-config>
